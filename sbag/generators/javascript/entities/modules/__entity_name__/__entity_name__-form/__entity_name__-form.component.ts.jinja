{% set entity_name = entity.name | lower %}
import { Component } from '@angular/core';
import { FormBuilder, FormControl, FormGroup } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { I{{entity.name}} } from 'src/app/shared/model/{{entity_name}}.model';
{% for property in entity.properties %}
{% if property | get_property_type != 'base' %}
import { I{{ property.ptype }} } from 'src/app/shared/model/{{property.ptype | lower}}.model';
{% endif %}
{% endfor %}
import { {{entity.name}}Service } from '../{{entity_name}}.service';

{% if entity | has_associations %}
interface ISelectLists {
{% for property in entity.properties %}
{% if property | get_property_type != 'base' %}
	{{ property.name }}List: I{{ property.ptype }}[],
{% endif %}
{% endfor %}
}
{% endif %}

@Component({
	selector: 'app-{{entity_name}}-form',
	templateUrl: './{{entity_name}}-form.component.html',
	styleUrls: ['./{{entity_name}}-form.component.css'],
})

export class {{entity.name}}FormComponent {
	update: boolean;
	id: number;
	entity: I{{ entity.name }} | undefined;
	form: FormGroup = new FormGroup({});

	{% if entity | has_associations %}
	selectLists: ISelectLists = {
	{% for property in entity.properties %}
	{% if property | get_property_type != 'base' %}
		{{ property.name }}List: [],
	{% endif %}
	{% endfor %}
	}
	{% endif %}

    constructor(private service: {{entity.name}}Service, private router: Router, private activatedRoute: ActivatedRoute, private fb: FormBuilder){
		this.form = this.fb.group({
			{% for property in entity.properties %}
			'{{ property.name }}': new FormControl(),
    		{% endfor %}
        });

		{% if entity | has_associations == True %}
		this.service.getLists().subscribe(
			(res: any) => {
			    this.selectLists = res;
				console.log(res);
			},
			(err: any) => {
				alert("error");
				console.log(err);
			}
	  	);
		{% endif %}

		if(this.router.url.includes('update')){
			this.update = true;
			this.id = Number(this.activatedRoute.snapshot.paramMap.get('id'));
			console.log(this.id);
			this.service.get{{entity.name}}(this.id).subscribe(
      			(res: any) => {
					this.entity = res;
					this.form.setValue({
					{% for property in entity.properties %}
						{{property.name}}: this.entity?.{{property.name}},
					{% endfor %}
					})
				},
				(err: any) => {
					alert("error");
					console.log(err);
				}
			);
		}
		else {
			this.id = 0;
			this.update = false;
		}
	}

	Submit() {
		{% for property in entity.properties %}
		let {{property.name}}Value = this.form.get('{{property.name}}')?.value
		{% endfor %}
		let dto: I{{entity.name}} = {
			{% for property in entity.properties %}
			{{property.name}}: {{property.name}}Value,
			{% endfor %}
		}
		console.log(dto)
		if(this.update) {
			this.service.update{{entity.name}}(this.id, dto).subscribe(
			(res: any) => {
				alert('updated');
				this.entity = res;
				this.form.setValue({
				{% for property in entity.properties %}
					{{property.name}}: this.entity?.{{property.name}},
				{% endfor %}
				})
			},
			(err) => {
				alert(err.message);
				console.log(err);
			});
		}
		else {
			this.service.create{{entity.name}}(dto).subscribe(
			(res) => {
				alert('created');
				this.form.reset()
			},
			(err) => {
				alert(err.message);
				console.log(err);
			});
		}
	}
}
